name: Commit executable

inputs:
  token:
    description: "Github API Token"
    required: true

runs:
  steps:
    - name: Get PR branch
      uses: mdecoleman/pr-branch-name@1.0.1
      id: pr_name
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}

    - name: Commit built executable
      shell: bash -l {0}
      run: |
        sudo chmod -R 0777 build

        git config --global user.name mantid-builder
        git config --global user.email mantid-builder@hosting.com
        git config --global credential.helper store
        echo https://mantid-builder:${{ inputs.token }}@github.com > ~/.git-credentials
        git checkout ${{ steps.pr_name.outputs.branch }}
        git add build/*
        git commit -m "Add executable for ${{ runner.os }}"
        git push